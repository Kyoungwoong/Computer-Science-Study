# 네트워크 계층

### 📝 네트워크 계층 개요

---

- **역할**: 송신 호스트 → 수신 호스트로 **패킷(데이터그램)** 전달
- **서비스 모델**: 인터넷은 **최선형(best-effort)**  
  → 전달/순서/지연/대역폭 **보장 없음**

<br/>

### 🔀 데이터 평면 vs 제어 평면

---

- **데이터 평면(포워딩)**: 들어온 패킷을 **어느 출력 포트로 보낼지 즉시 결정**
- **Longest prefix matching**:  포워딩 과정에서 가장 긴 범위의 prefix 가 매칭이 되는 주소로 결정.
- **제어 평면(라우팅)**: 네트워크 전반의 **경로 계산**과 **포워딩 테이블 설정**
  - 포워딩과 라우팅의 관계: 라우팅 알고리즘을 통해 포워딩 테이블을 작성하고, <br>
    포워딩 테이블이 패킷이 들어왔을때 다음 link 를 결정한다.
- **SDN 관점**: 중앙 **컨트롤러**가 경로/정책을 계산·배포, 장비는 **포워딩에 집중**

<br/>

### 🧱 라우터 내부

---

- **입력 포트**: L1/L2 처리 → **포워딩 테이블 조회(최장 프리픽스 일치)** → 스위치 구조로 전달  
- **스위치 구조(Fabric)**: 입력 ↔ 출력 연결(메모리/버스/크로스바 등 구현)
- **출력 포트**: 큐잉·스케줄링 후 링크로 송신
- **라우팅 프로세서**: 라우팅 프로토콜 실행, 테이블 관리(또는 SDN 컨트롤러와 연동)

<br/>

### 🌐 IP와 주소 (IPv4 / IPv6 공통)

---

IP 프로토콜의 주요 기능: **주소 지정(Addressing)**, **단편화(Fragmentation)**

#### 📌 주소 지정
- **IPv4 데이터그램 헤더**: 버전, 길이, TTL, 상위 프로토콜(TCP/UDP), 출발지/목적지 주소 포함
- **주소 단위**: 장비가 아닌 **인터페이스 단위**로 IP 부여
- **ClassFul Address**: IP 주소를 클래스 별로 나누어 표현
- **CIDR**: `a.b.c.d/x` 형태로 표현, **프리픽스 기반 주소 요약**
- **DHCP**: IP 주소를 동적으로 임대해주는 프로토콜
- **브로드캐스트**
  - 제한적 브로드캐스트: `255.255.255.255` (로컬 네트워크 전용)
  - 지정 브로드캐스트: 네트워크ID + all 1 (예: `192.168.1.255`)

#### 📌 단편화(Fragmentation)
- 네트워크 경로의 **MTU(Maximum Transmission Unit)**보다 큰 패킷을 작은 조각으로 나누는 과정
- 송신측·라우터에서 단편화, 수신측에서 재조립


<br/>

### 📡 DHCP (Dynamic Host Configuration Protocol)

---

#### 📌 DHCP 개요
- **DHCP**: 클라이언트가 네트워크 접속 시 **자동으로 IP 주소 및 관련 정보**(서브넷 마스크, 게이트웨이, DNS 등)를 할당받는 프로토콜
- **임대(Lease)** 방식으로 주소 관리
- **포트 번호**: 서버(67), 클라이언트(68)

---

#### 🔄 DHCP 동작 과정 (DORA)
1. **Discover**  
   - 클라이언트 → 브로드캐스트(`255.255.255.255:67`)  
   - "IP 주소 줄 서버 있나요?"

2. **Offer**  
   - 서버 → 브로드캐스트(`255.255.255.255:68`)  
   - transaction ID 로 구별  
   - "이 IP 주소(예: 223.1.2.4) 사용 가능"

3. **Request**  
   - 클라이언트 → 브로드캐스트(`255.255.255.255:67`)  
   - "저 이 주소 쓰겠습니다"

4. **ACK**  
   - 서버 → 브로드캐스트(`255.255.255.255:68`)  
   - "확인 완료! 이제 사용하세요"


<br/>

### 🔁 NAT (Network Address Translation)

---

- 내부 **사설 IP ↔ 공인 IP:포트** 매핑으로 다수 호스트가 하나의 공인 IP 사용, 사설 ip 는 global unique 하지 않음.  
- outbound : src ip 주소를 재작성, inbound : dest ip 주소를 재작성
- **장점**: 주소 절약, 내부 구조 은닉 / **제약**: 인바운드 연결·서버 운영 시 추가 설정(NAT 트래버설/포트포워딩)

<br/>

### 🆚 IPv4 ↔ IPv6

---

| 항목        | IPv4                 | IPv6                                   |
|-------------|----------------------|-----------------------------------------|
| 주소 길이   | 32비트               | **128비트**                             |
| 헤더        | 가변(옵션 포함)      | **고정 40B** + 확장 헤더                |
| 단편화      | 라우터/끝점           | **끝점만**(라우터는 과대 패킷 폐기 알림) |
| 체크섬      | 있음                 | **없음**(상·하위 계층 검증 의존)        |
| 주소 유형   | 유니/멀티캐스트      | 유니/멀티 + **애니캐스트**              |
| 전환 방식   | —                    | **듀얼스택**, **터널링(IPv6-in-IPv4)**   |

<br/>

### ⏳ 큐잉 & 스케줄링

---

- **입력 큐**: 스위치가 바쁘면 대기, **HOL(Head-of-Line) 차단** 가능  
- **출력 큐**: 다수 입력이 한 출력으로 몰리면 대기/드롭  
- **스케줄링 예**: **FIFO**, **우선순위 큐**, **라운드로빈/WFQ**  
- **버퍼블로트**: 버퍼 과대 → 손실은 줄지만 **지연이 길어짐**

<br/>

### 🛰️ 라우팅 알고리즘

---

- **Link State(LS)**: 링크 상태(비용)를 **플러딩**하여 **전역 토폴로지** 공유 → 각 노드가 **SPF(Dijkstra)**로 최단경로 계산  
- **Distance Vector(DV)**: 이웃과 **거리 벡터**를 교환하는 **분산** 방식 → 단순하지만 느린 수렴/루프 이슈 존재  
- **Hierarchical**: 규모 확장을 위해 **자율시스템(AS)** 단위로 계층화, **요약/집계**로 테이블 축소

<br/>

### 🌍 인터넷 라우팅 프로토콜(IGP/EGP 큰 흐름)

---

- **RIP**(IGP, DV): **홉 수** 기반, 단순하지만 **대규모/수렴 속도에 한계**  
- **OSPF**(IGP, LS): **링크 비용** 기반, **에어리어 구조**와 빠른 수렴, 인증/ECMP 등 풍부한 기능  
- **BGP**(EGP, Path-Vector): **AS 간 정책 라우팅의 표준**, 다양한 **경로 속성**으로 최선 경로 선택(전 세계 인터넷을 결속)

<br/>

### 🧠 SDN · OpenFlow(포워딩을 프로그래밍하기)

---

- **매치 → 액션** 모델: 다계층 헤더/진입 포트로 **매치**하고 **포워딩·드롭·복제·헤더수정** 등의 **액션** 수행  
- **컨트롤러가 플로우 규칙을 배포**해 네트워크 동작을 일관되게 변경/관리

<br/>

### 🧳 미들박스(경로 중간의 추가 기능)

---

- **NAT**, **방화벽/IDS/IPS(DPI)**, **로드밸런서/프록시/캐시/WAN 가속** 등  
- 장점: 보안·성능·운영 편의 / 고려사항: **계층 경계**를 넘는 검사·변조

